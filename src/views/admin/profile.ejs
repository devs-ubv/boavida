<%- include('./partials/head'); -%>
    <!-- =============== Navigation ================ -->
    <div class="container">
        <%- include('./partials/sidebar'); -%>
            <!-- ========================= Main ==================== -->
            <div class="main">

                <%- include('./partials/nav'); -%>
                    <!-- ======================= conteúdo do usuario ================== -->
                    <div class="flex items-center justify-around rounded-xl shadow-md py-10">
                        <div>
                            <div class="px-10 ">
                                <div class="profile-user flex flex-col relative w-60 h-60">
                                    <img id="image-preview" class=" rounded-md w-60 h-60" src="/assets/img/user/<%=session.userProfile %>" alt="user">
                                    <label for="fileInput" class="profile-photo absolute h-[50%] w-60 left-0 bottom-0 right-0 "></label>
                                    <input type="file" id="fileInput" style="display: none;" multiple>
                                    <button id="remove" class="top-0 absolute right-0">X</button>

                                </div>
                                <div class="flex items-start flex-col justify-center py-4">
                                    <h3>
                                        <%=session.fullName %>
                                    </h3>

                                    <div class="py-2 w-full border">
                                        <button id="upload-profile" class="bg-[#091E3E] w-full py-2 text-white">Actualizar</button>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <div>
                            <div>
                                <h3>
                                    <%=session.email %>
                                </h3>
                                <ul>
                                    <li>
                                        <%=session.phoneNumber %>
                                    </li>
                                    <li>
                                        <%=session.type %>
                                    </li>


                                </ul>
                            </div>
                        </div>
                    </div>
            </div>

            <%- include( './partials/footer'); -%>


                <script>
                    $(document).ready(function() {
                        // Adiciona um ouvinte de alteração ao input de arquivo
                        $("#fileInput").change(function() {
                            uploadProfile(this);
                            previewImage(this);
                        });

                        // Função para exibir a pré-visualização da imagem
                        function previewImage(input) {
                            var file = input.files[0];
                            if (file) {
                                var reader = new FileReader();

                                reader.onload = function(e) {
                                    $("#image-preview").attr("src", e.target.result);
                                };

                                // Lê o conteúdo da imagem como uma URL de dados
                                reader.readAsDataURL(file);
                            } else {
                                // Limpa a pré-visualização se nenhum arquivo for selecionado
                                $("#image-preview").empty();
                            }
                        }


                        function uploadProfile(input) {
                            var file = input.files[0];
                            console.log(file);
                        }
                        $("#remove").click(function() {
                            alert("estou a remover");
                            $("#image-preview").text("");
                        })

                        $("#upload-profile").click(function() {
                            var file = $("#fileInput")[0].files[0];
                            var formData = new FormData();
                            formData.append('userProfile', file);
                            fetch('/user/upload', {
                                    method: 'PUT',
                                    body: formData
                                })
                                .then(response => response.json())
                                .then(data => {
                                    console.log(data)
                                })
                                .catch(error => {
                                    console.error('Erro ao enviar arquivo:', error);
                                });

                        });






                    });
                </script>